---
#override.yaml
fluent-bit: 
  config:
    filters: |-
      [FILTER]
          Name kubernetes
          Match kube.*
          K8S-Logging.Parser On
          K8S-Logging.Exclude On
          Use_Kubelet On
          Annotations Off
          Labels On
          Buffer_Size 0
          Keep_Log Off
          Merge_Log_Key log_obj
          Merge_Log On

      [FILTER]
          Name            nest
          Match           kube.*
          Operation       lift
          Nested_under    kubernetes
          Add_prefix      kubernetes.

      [FILTER]
          Name    modify
          Match   kube.*
          Add     applicationName ${APP_NAME}
          Copy    ${SUB_SYSTEM} subsystemName 

      [FILTER]
          Name            nest
          Match           kube.*
          Operation       nest
          Wildcard        kubernetes.*
          Nest_under      kubernetes
          Remove_prefix   kubernetes.

      [FILTER]
          Name        nest
          Match       kube.*
          Operation   nest
          Wildcard    kubernetes
          Wildcard    log
          Wildcard    log_obj
          Wildcard    stream
          Wildcard    time
          Nest_under  json

      @INCLUDE filters-systemd.conf

    inputs: |-
      [INPUT]
          Name tail
          Path /var/log/containers/*.log
          multiline.parser docker, cri
          Tag example-tag.*
          Refresh_Interval 10
          Skip_Long_Lines On
          Mem_Buf_Limit 15MB
          DB /var/log/fluentbit-tail.db

      @INCLUDE input-systemd.conf

    extraFiles:
      input-systemd.conf: |-
        [INPUT]
            Name systemd
            Tag example-systemd-tag.*
            Systemd_Filter _SYSTEMD_UNIT=kubelet.service
            Read_From_Tail On
            Mem_Buf_Limit 2MB